import{d as ye,r as c,w as he,o as Be,a as rt,c as p,b as z,F as Z,e as Q,f as y,g as ze,h as ee,i as G,j as _,t as de,n as R,k as H,l as D,m as h,u as pe,p as vt,q as ht,s as dt,v as pt,x as Ke,y as ft,z as Pe}from"./index-BV0vVW2a.js";const mt=""+new URL("logo-DOphsjsJ.png",import.meta.url).href,yt={class:"node-palette"},gt=["onDragstart"],xt={class:"scale-control"},wt={style:{width:"50px","text-align":"center"}},bt={key:0},$t=["onClick"],Ct={key:1},_t=["width","height"],kt=["d","stroke-width","stroke","onClick"],Mt=["d"],St=["id","onMousedown","onClick"],Vt={class:"node-label",style:{position:"absolute",top:"-30px"}},zt={key:0,class:"selection-box"},Et=["onMousedown"],Lt=["onMousedown"],Xt=["onMousedown"],Dt=["onMousedown"],Yt={class:"config-panel"},Ot={key:1,style:{color:"#999","font-size":"14px"}},Tt={key:2,style:{color:"#999","font-size":"14px"}},Rt={key:3},Pt=50,Bt=ye({__name:"CflowEditorLoader",props:{bg:{default:""},isConnectionType:{type:Boolean,default:!1},nodeTypes:{},connections:{default:[]},nodesValue:{default:[]}},emits:["getcanvasSize","getConnections","getNodesValue","saveNodes","getNodes"],setup(oe,{emit:N}){const Y=oe,k=N,T=c(Y.nodeTypes),v=c(Y.nodesValue);he(()=>Y.nodesValue,e=>{v.value=e});const w=c(Y.connections);he(()=>Y.connections,e=>{w.value=e});const E=c(),B=c(),K=c(),x=c([]),m=c(-1),$=()=>{m.value<x.value.length-1&&(x.value=x.value.slice(0,m.value+1));const e={nodes:JSON.parse(JSON.stringify(v.value)),connections:JSON.parse(JSON.stringify(w.value))};x.value.push(e),x.value.length>Pt&&x.value.shift(),m.value=x.value.length-1};$();const F=()=>{if(m.value<=0)return;m.value--;const e=x.value[m.value];v.value=JSON.parse(JSON.stringify(e.nodes)),w.value=JSON.parse(JSON.stringify(e.connections)),i.value=[],u.value="",k("getNodesValue",v.value),k("getConnectionsValue",w.value)},d=()=>{if(m.value>=x.value.length-1)return;m.value++;const e=x.value[m.value];v.value=JSON.parse(JSON.stringify(e.nodes)),w.value=JSON.parse(JSON.stringify(e.connections)),k("getNodesValue",v.value),k("getConnectionsValue",w.value)},i=c([]),u=c(""),O=c("curve"),P=c([]),ge=c({x:0,y:0}),ue=c({}),V=c(1),C=c({x:0,y:0}),M=c({width:1920,height:1080});he(()=>M.value,()=>{k("getcanvasSize",M.value)});const ae=c(!1),xe=c({x:0,y:0}),j=c(!1),q=c(!1),g=c({show:!1,x:0,y:0,width:0,height:0}),I=c(!1),J=c({x:0,y:0}),b=c({width:0,height:0}),we=c(""),te=c(null),se=c(null),ce=c(null),X=c(!1),le=c(""),W=c({x:0,y:0}),re=c([]),A=c(8),ne=c(!0),Ie=e=>{const t=v.value.filter(o=>i.value.includes(o.id));e==="left"&&(t.sort((o,n)=>o.x-n.x),t.map(o=>{o.x=t[0].x})),e==="right"&&(t.sort((o,n)=>o.x-n.x),t.map(o=>{o.x=t[t.length-1].x})),e==="top"&&(t.sort((o,n)=>o.y-n.y),t.map(o=>{o.y=t[0].y})),e==="bottom"&&(t.sort((o,n)=>o.y-n.y),t.map(o=>{o.y=t[t.length-1].y}))},Ee=()=>{v.value.filter(t=>i.value.includes(t.id)).forEach(t=>{t.width=B.value,t.height=K.value})},U=(e,t)=>{const o=se.value.getBoundingClientRect();return{x:(e-o.left-C.value.x)/V.value,y:(t-o.top-C.value.y)/V.value}},Je=(e,t)=>{e.dataTransfer.setData("text/plain",JSON.stringify(t)),e.dataTransfer.effectAllowed="copy"},Ue=e=>{if(document.getElementById(e.id),i.value.includes(e.id)){const t=i.value.indexOf(e.id);i.value.splice(t,1)}else i.value.push(e.id)},He=(e,t)=>{if(console.log(e,t),e.button===2||j.value||q.value||I.value||X.value)return;!e.ctrlKey&&!e.shiftKey&&!i.value.includes(t.id)?i.value=[t.id]:(e.ctrlKey||e.shiftKey)&&!i.value.includes(t.id)&&i.value.push(t.id),P.value=[...i.value],ue.value={},i.value.forEach(n=>{const l=v.value.find(r=>r.id===n);l&&(ue.value[n]={x:l.x,y:l.y})});const o=U(e.clientX,e.clientY);ge.value={x:o.x,y:o.y},document.addEventListener("mousemove",be),document.addEventListener("mouseup",$e)},Le=e=>{const t=[],o=v.value.filter(n=>!e.some(l=>l.id===n.id));return e.forEach(n=>{const l={left:n.x,right:n.x+n.width,top:n.y,bottom:n.y+n.height,centerX:n.x+n.width/2,centerY:n.y+n.height/2};Math.abs(l.centerX-M.value.width/2)<=A.value&&(t.push({id:`guide-v-canvas-center-${n.id}`,left:M.value.width/2,top:0,width:2,height:M.value.height,color:"rgba(255, 0, 255, 0.7)"}),ne.value&&(n.x=M.value.width/2-n.width/2)),Math.abs(l.centerY-M.value.height/2)<=A.value&&(t.push({id:`guide-h-canvas-center-${n.id}`,left:0,top:M.value.height/2,width:M.value.width,height:2,color:"rgba(255, 0, 255, 0.7)"}),ne.value&&(n.y=M.value.height/2-n.height/2)),o.forEach(r=>{const a={left:r.x,right:r.x+r.width,top:r.y,bottom:r.y+r.height,centerX:r.x+r.width/2,centerY:r.y+r.height/2};[{condition:Math.abs(l.top-a.top)<=A.value,guide:{id:`guide-h-top-${n.id}-${r.id}`,left:Math.min(l.left,a.left),top:a.top,width:Math.max(l.right,a.right)-Math.min(l.left,a.left),height:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.y=a.top}},{condition:Math.abs(l.bottom-a.bottom)<=A.value,guide:{id:`guide-h-bottom-${n.id}-${r.id}`,left:Math.min(l.left,a.left),top:a.bottom,width:Math.max(l.right,a.right)-Math.min(l.left,a.left),height:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.y=a.bottom-n.height}},{condition:Math.abs(l.centerY-a.centerY)<=A.value,guide:{id:`guide-h-center-${n.id}-${r.id}`,left:Math.min(l.left,a.left),top:a.centerY,width:Math.max(l.right,a.right)-Math.min(l.left,a.left),height:2,color:"rgba(255, 0, 0, 0.7)"},snap:()=>{n.y=a.centerY-n.height/2}},{condition:Math.abs(l.left-a.left)<=A.value,guide:{id:`guide-v-left-${n.id}-${r.id}`,left:a.left,top:Math.min(l.top,a.top),height:Math.max(l.bottom,a.bottom)-Math.min(l.top,a.top),width:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.x=a.left}},{condition:Math.abs(l.right-a.right)<=A.value,guide:{id:`guide-v-right-${n.id}-${r.id}`,left:a.right,top:Math.min(l.top,a.top),height:Math.max(l.bottom,a.bottom)-Math.min(l.top,a.top),width:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.x=a.right-n.width}},{condition:Math.abs(l.centerX-a.centerX)<=A.value,guide:{id:`guide-v-center-${n.id}-${r.id}`,left:a.centerX,top:Math.min(l.top,a.top),height:Math.max(l.bottom,a.bottom)-Math.min(l.top,a.top),width:2,color:"rgba(255, 0, 0, 0.7)"},snap:()=>{n.x=a.centerX-n.width/2}},{condition:Math.abs(l.top-a.bottom)<=A.value,guide:{id:`guide-h-top-bottom-${n.id}-${r.id}`,left:Math.min(l.left,a.left),top:a.bottom,width:Math.max(l.right,a.right)-Math.min(l.left,a.left),height:2,color:"rgba(0, 150, 255, 0.7)"},snap:()=>{n.y=a.bottom}},{condition:Math.abs(l.bottom-a.top)<=A.value,guide:{id:`guide-h-bottom-top-${n.id}-${r.id}`,left:Math.min(l.left,a.left),top:a.top,width:Math.max(l.right,a.right)-Math.min(l.left,a.left),height:2,color:"rgba(0, 150, 255, 0.7)"},snap:()=>{n.y=a.top-n.height}}].forEach(L=>{L.condition&&(t.push(L.guide),ne.value&&L.snap())})})}),t},be=e=>{if(P.value.length===0)return;const t=U(e.clientX,e.clientY),o=t.x-ge.value.x,n=t.y-ge.value.y,l=[];P.value.forEach(a=>{const f=v.value.find(L=>L.id===a);f&&ue.value[a]&&(f._tempX=ue.value[a].x+o,f._tempY=ue.value[a].y+n,l.push(f))}),l.forEach(a=>{a.x=a._tempX,a.y=a._tempY});let r=[];ne.value&&(r=Le(l)),re.value=r},$e=()=>{P.value=[],re.value=[],document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",$e),k("getNodesValue",v.value),$()},Fe=e=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");if(t)try{const o=JSON.parse(t),n=U(e.clientX,e.clientY),l={id:`node-${Date.now()}`,...o,label:"未命名节点"+v.value.length,x:n.x-o.width/2,y:n.y-o.height/2,obj:{}};v.value.push(l),fe.value=l,i.value=[l.id],k("getNodesValue",v.value),$()}catch(o){console.error("放置节点失败:",o)}},fe=c({}),We=(e,t)=>{u.value="",!(j.value||q.value||I.value||X.value)&&(fe.value=t,e.ctrlKey||e.shiftKey?i.value.includes(t.id)||i.value.push(t.id):i.value=[t.id])},me=(e,t,o)=>{if(i.value.length!==1||X.value)return;I.value=!0,we.value=o;const n=U(e.clientX,e.clientY);J.value={x:n.x,y:n.y},b.value={width:t.width,height:t.height},document.addEventListener("mousemove",Ce),document.addEventListener("mouseup",_e),e.stopPropagation()},Ce=e=>{if(!I.value)return;const t=U(e.clientX,e.clientY),o=t.x-J.value.x,n=t.y-J.value.y,l=v.value.find(a=>a.id===i.value[0]);if(!l)return;const r=b.value.width/b.value.height;switch(we.value){case"se":if(e.ctrlKey){const a=Math.max(20,b.value.width+o),f=a/r;l.width=a,l.height=f}else l.width=Math.max(20,b.value.width+o),l.height=Math.max(20,b.value.height+n);break;case"sw":if(e.ctrlKey){const a=Math.max(20,b.value.width-o),f=a/r;l.width=a,l.height=f,l.x=J.value.x-(l.width-b.value.width)}else l.width=Math.max(20,b.value.width-o),l.height=Math.max(20,b.value.height+n),l.x=J.value.x-(l.width-b.value.width);break;case"ne":if(e.ctrlKey){const a=Math.max(20,b.value.width+o),f=a/r;l.width=a,l.height=f,l.y=J.value.y-(l.height-b.value.height)}else l.width=Math.max(20,b.value.width+o),l.height=Math.max(20,b.value.height-n),l.y=J.value.y-(l.height-b.value.height);break;case"nw":if(e.ctrlKey){const a=Math.max(20,b.value.width-o),f=a/r;l.width=a,l.height=f,l.x=J.value.x-(l.width-b.value.width),l.y=J.value.y-(l.height-b.value.height)}else l.width=Math.max(20,b.value.width-o),l.height=Math.max(20,b.value.height-n),l.x=J.value.x-(l.width-b.value.width),l.y=J.value.y-(l.height-b.value.height);break}if(ne.value&&l){const a=Le([l]);re.value=a}},_e=()=>{I.value=!1,we.value="",re.value=[],document.removeEventListener("mousemove",Ce),document.removeEventListener("mouseup",_e),$()},Ae=e=>{if(u.value="",j.value||e.target!==ce.value||I.value||X.value)return;q.value=!0;const t=U(e.clientX,e.clientY);g.value={show:!0,x:t.x,y:t.y,width:0,height:0},document.addEventListener("mousemove",ke),document.addEventListener("mouseup",Me)},ie=c({}),ke=e=>{if(!q.value)return;const t=U(e.clientX,e.clientY);ie.value={show:!0,x:t.x<g.value.x?t.x:g.value.x,y:t.y<g.value.y?t.y:g.value.y,width:t.x-g.value.x,height:t.y-g.value.y},g.value={show:!0,x:g.value.x,y:g.value.y,width:t.x-g.value.x,height:t.y-g.value.y};const o=Math.min(g.value.x,g.value.x+g.value.width),n=Math.min(g.value.y,g.value.y+g.value.height),l=Math.max(g.value.x,g.value.x+g.value.width),r=Math.max(g.value.y,g.value.y+g.value.height),a=[];v.value.forEach(f=>{const L=f.x,Ve=f.y,s=f.x+f.width,S=f.y+f.height;s>o&&L<l&&S>n&&Ve<r&&a.push(f.id)}),i.value=a},Me=()=>{q.value=!1,g.value.show=!1,ie.value={},document.removeEventListener("mousemove",ke),document.removeEventListener("mouseup",Me)},Ge=e=>{if(e.target===ce.value&&(u.value=""),X.value){X.value=!1,le.value="";return}e.target===ce.value&&e.ctrlKey&&!j.value&&!I.value?Ae(e):e.target===ce.value&&!j.value&&!q.value&&!e.ctrlKey&&!I.value&&(i.value=[],B.value="",K.value="",E.value="")},Xe=()=>{if(i.value.length===0)return;const e=v.value.find(t=>t.id===i.value[0]);e&&(te.value=JSON.parse(JSON.stringify(e)),te.value.label=te.value.label+"-copy")},De=()=>{if(!te.value)return;const e={...JSON.parse(JSON.stringify(te.value)),id:`node-${Date.now()}`,x:te.value.x+20,y:te.value.y+20};v.value.push(e),i.value=[e.id],$()},Ne=()=>{i.value.length!==0&&(v.value=v.value.filter(e=>!i.value.includes(e.id)),k("getNodesValue",v.value),w.value=w.value.filter(e=>!i.value.includes(e.source)&&!i.value.includes(e.target)),i.value=[],k("getConnectionsValue",w.value),$())},Ye=()=>{u.value&&(w.value=w.value.filter(e=>e.id!==u.value),u.value="",k("getConnectionsValue",w.value),$())},je=e=>{e.preventDefault();const t=se.value.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top,l=(o-C.value.x)/V.value,r=(n-C.value.y)/V.value,f=-e.deltaY>0?1.1:.9,L=Math.max(.1,Math.min(5,V.value*f));C.value.x=o-l*L,C.value.y=n-r*L,V.value=L},qe=e=>{j.value&&e.button===0&&!I.value&&!X.value&&(ae.value=!0,xe.value={x:e.clientX-C.value.x,y:e.clientY-C.value.y},e.preventDefault())},Ze=e=>{if(ae.value)C.value.x=e.clientX-xe.value.x,C.value.y=e.clientY-xe.value.y;else if(X.value){const t=U(e.clientX,e.clientY);W.value=t}},Oe=()=>{ae.value=!1},Te=e=>{if(e.ctrlKey||e.metaKey){if(e.key.toLowerCase()==="z"){F(),e.preventDefault();return}else if(e.key.toLowerCase()==="y"){d(),e.preventDefault();return}}if(e.key==="Delete"&&u.value){Ye(),e.preventDefault();return}if(e.code==="Space"&&(j.value=!0,e.preventDefault()),e.key==="Alt"&&(ne.value=!1),e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"c":Xe(),e.preventDefault();break;case"v":De(),e.preventDefault();break;case"d":Xe(),De(),e.preventDefault();break}if(e.key==="Backspace"){const t=document.activeElement;t.tagName==="INPUT"||t.tagName==="TEXTAREA"||(Ne(),e.preventDefault())}},Re=e=>{e.code==="Space"&&(j.value=!1,ae.value=!1),e.key==="Alt"&&(ne.value=!0)},Qe=()=>{const e=se.value.getBoundingClientRect(),t=e.width/2,o=e.height/2,n=(t-C.value.x)/V.value,l=(o-C.value.y)/V.value,r=Math.min(5,V.value+.1);C.value.x=t-n*r,C.value.y=o-l*r,V.value=r},et=()=>{const e=se.value.getBoundingClientRect(),t=e.width/2,o=e.height/2,n=(t-C.value.x)/V.value,l=(o-C.value.y)/V.value,r=Math.max(.1,V.value-.1);C.value.x=t-n*r,C.value.y=o-l*r,V.value=r},tt=()=>{V.value=1,C.value={x:0,y:0}},lt=e=>{if(!Y.isConnectionType)return;q.value=!1,I.value=!1,ae.value=!1,u.value="",X.value=!0,le.value=e.id,se.value.getBoundingClientRect();const t=U(event.clientX,event.clientY);W.value=t,document.addEventListener("mousemove",Se)},Se=e=>{if(!X.value)return;const t=U(e.clientX,e.clientY);W.value=t},nt=e=>{if(!X.value)return;document.removeEventListener("mousemove",Se);const t=U(e.clientX,e.clientY),o=v.value.find(n=>t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height&&n.id!==le.value);o&&(w.value.push({id:`conn-${Date.now()}`,source:le.value,target:o.id}),k("getConnectionsValue",w.value),$()),X.value=!1,le.value=""},ve=e=>{const t=v.value.find(o=>o.id===e);return t?{x:t.x+t.width/2,y:t.y+t.height/2}:{x:0,y:0}},ot=e=>O.value==="mindmap"?st(e):at(e),at=e=>{const t=ve(e.source),o=ve(e.target),n=(t.x+o.x)/2;return`M ${t.x} ${t.y}
          C ${n} ${t.y},
            ${n} ${o.y},
            ${o.x} ${o.y}`},st=e=>{const t=ve(e.source),o=ve(e.target),n=50,l=t.x+n;return o.x>l&&o.x-n,`M ${t.x} ${t.y}
          L ${l} ${t.y}
          L ${l} ${o.y}
          L ${o.x} ${o.y}`},it=()=>{const e=ve(le.value);if(O.value==="mindmap"){const o=e.x+50;return`M ${e.x} ${e.y}
            L ${o} ${e.y}
            L ${o} ${W.value.y}
            L ${W.value.x} ${W.value.y}`}else{const t=(e.x+W.value.x)/2;return`M ${e.x} ${e.y}
            C ${t} ${e.y},
              ${t} ${W.value.y},
              ${W.value.x} ${W.value.y}`}},ut=e=>{i.value=[],u.value=e};he(v,()=>{},{deep:!0}),he(O,()=>{}),Be(()=>{document.querySelector(".flow-editor").focus()});const ct=()=>{k("saveNodes",v.value)};return rt(()=>{document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",$e),document.removeEventListener("mousemove",ke),document.removeEventListener("mouseup",Me),document.removeEventListener("mousemove",Ce),document.removeEventListener("mouseup",_e),document.removeEventListener("keydown",Te),document.removeEventListener("keyup",Re),document.removeEventListener("mousemove",Se)}),(e,t)=>{const o=G("el-icon"),n=G("el-button"),l=G("el-option"),r=G("el-select"),a=G("el-popover"),f=G("el-input"),L=G("el-radio"),Ve=G("el-radio-group");return h(),p("div",{class:"flow-editor",onWheel:je,onKeydown:Te,onKeyup:Re,onMousedown:qe,onMousemove:Ze,onMouseup:Oe,onMouseleave:Oe,tabindex:"0"},[z("div",yt,[(h(!0),p(Z,null,Q(T.value,s=>(h(),p("div",{style:R({width:s.width+"px",height:s.height+"px",backgroundColor:s.color,borderRadius:s.type==="start"?"50%":"4px"}),key:s.type,class:"palette-node",draggable:"true",onDragstart:S=>Je(S,s)},de(s.label),45,gt))),128))]),z("div",{class:"flow-canvas-container",ref_key:"canvasContainer",ref:se,style:R({cursor:ae.value?"grabbing":j.value?"grab":q.value||X.value?"crosshair":"default"})},[z("div",xt,[y(o,{onClick:Qe},{default:_(()=>[y(pe(vt))]),_:1}),z("div",wt,de(Math.round(V.value*100))+"%",1),y(o,{onClick:et},{default:_(()=>[y(pe(ht))]),_:1}),y(n,{size:"small",onClick:tt},{default:_(()=>t[9]||(t[9]=[D("重置",-1)])),_:1,__:[9]}),y(o,{onClick:F,disabled:m.value<0,style:R([{"margin-left":"10px",cursor:"pointer"},{opacity:m.value<0?.5:1}])},{default:_(()=>[y(pe(dt))]),_:1},8,["disabled","style"]),y(o,{onClick:d,disabled:m.value>=x.value.length-1,style:R([{cursor:"pointer"},{opacity:m.value>=x.value.length-1?.5:1}])},{default:_(()=>[y(pe(pt))]),_:1},8,["disabled","style"]),e.isConnectionType?(h(),ze(r,{key:0,size:"small",modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=s=>O.value=s),style:{width:"120px","margin-left":"10px"},placeholder:"连线方式"},{default:_(()=>[y(l,{label:"曲线",value:"curve"})]),_:1},8,["modelValue"])):ee("",!0),y(a,{placement:"bottom",width:400,trigger:"hover"},{reference:_(()=>[y(n,{size:"small",style:{"margin-right":"16px"}},{default:_(()=>t[10]||(t[10]=[D("图层",-1)])),_:1,__:[10]})]),default:_(()=>[v.value.length>0?(h(),p("div",bt,[(h(!0),p(Z,null,Q(v.value,(s,S)=>(h(),p("div",{style:R({color:i.value.includes(s.id)?"red":""}),class:"liners",onClick:Nt=>Ue(s),key:s.id},de(s.label),13,$t))),128))])):(h(),p("div",Ct,"请选择图层"))]),_:1})]),z("div",{class:"flow-canvas",ref_key:"canvas",ref:ce,style:R({backgroundImage:`url(${e.bg})`,transform:`translate(${C.value.x}px, ${C.value.y}px) scale(${V.value})`,transformOrigin:"0 0",width:`${M.value.width}px`,height:`${M.value.height}px`}),onDragover:t[1]||(t[1]=H(()=>{},["prevent"])),onDrop:Fe,onMousedown:Ge,onMouseup:nt,onContextmenu:t[2]||(t[2]=H(()=>{},["prevent"]))},[(h(!0),p(Z,null,Q(re.value,s=>(h(),p("div",{key:s.id,style:R({position:"absolute",left:s.left+"px",top:s.top+"px",width:s.width+"px",height:s.height+"px",background:s.color,zIndex:40}),class:"alignment-guide"},null,4))),128)),(h(),p("svg",{class:"connections-container",width:M.value.width,height:M.value.height},[z("g",null,[(h(!0),p(Z,null,Q(w.value,s=>(h(),p("path",{key:s.id,d:ot(s),"stroke-width":(u.value===s.id,5),stroke:u.value===s.id?"#000":"#3b82f6",fill:"none",class:"connection-line",onClick:H(S=>ut(s.id),["stop"]),style:{cursor:"pointer"}},null,8,kt))),128))]),X.value?(h(),p("path",{key:0,d:it(),stroke:"#666","stroke-width":"2","stroke-dasharray":"5,5",fill:"none"},null,8,Mt)):ee("",!0)],8,_t)),(h(!0),p(Z,null,Q(v.value,s=>(h(),p("div",{key:s.id,class:Ke(["flow-node",{selected:i.value.includes(s.id),dragging:P.value.includes(s.id),resizing:I.value,"connection-source":X.value&&le.value===s.id}]),id:s.id,style:R({left:`${s.x}px`,top:`${s.y}px`,width:`${s.width}px`,height:`${s.height}px`,backgroundColor:s.color,borderRadius:s.type==="start"?"50%":"4px"}),onMousedown:[H(S=>He(S,s),["stop"]),H(S=>lt(s),["right","prevent"])],onClick:H(S=>We(S,s),["stop"])},[z("div",Vt,de(s.label),1),i.value.includes(s.id)?(h(),p("div",zt,[z("div",{class:"resize-handle resize-handle-se",onMousedown:H(S=>me(S,s,"se"),["stop"])},null,40,Et),z("div",{class:"resize-handle resize-handle-sw",onMousedown:H(S=>me(S,s,"sw"),["stop"])},null,40,Lt),z("div",{class:"resize-handle resize-handle-ne",onMousedown:H(S=>me(S,s,"ne"),["stop"])},null,40,Xt),z("div",{class:"resize-handle resize-handle-nw",onMousedown:H(S=>me(S,s,"nw"),["stop"])},null,40,Dt)])):ee("",!0)],46,St))),128)),g.value.show?(h(),p("div",{key:0,class:"selection-box-area",style:R({"--box-x":`${ie.value.x}px`,"--box-y":`${ie.value.y}px`,"--box-width":`${ie.value.width}px`,"--box-height":`${ie.value.height}px`})},null,4)):ee("",!0)],36)],4),z("div",Yt,[y(n,{onClick:ct},{default:_(()=>t[11]||(t[11]=[D("预览",-1)])),_:1,__:[11]}),i.value.length===1?(h(),ze(f,{key:0,modelValue:fe.value.label,"onUpdate:modelValue":t[3]||(t[3]=s=>fe.value.label=s),placeholder:"节点名称"},null,8,["modelValue"])):i.value.length?(h(),p("div",Tt,[t[18]||(t[18]=D(" 宽度：",-1)),y(f,{onChange:Ee,modelValue:B.value,"onUpdate:modelValue":t[6]||(t[6]=s=>B.value=s)},null,8,["modelValue"]),t[19]||(t[19]=D(" 高度：",-1)),y(f,{onChange:Ee,modelValue:K.value,"onUpdate:modelValue":t[7]||(t[7]=s=>K.value=s)},null,8,["modelValue"]),t[20]||(t[20]=D(" 对齐方式: ",-1)),y(Ve,{onChange:Ie,modelValue:E.value,"onUpdate:modelValue":t[8]||(t[8]=s=>E.value=s)},{default:_(()=>[y(L,{label:"left"},{default:_(()=>t[14]||(t[14]=[D("左",-1)])),_:1,__:[14]}),y(L,{label:"right"},{default:_(()=>t[15]||(t[15]=[D("右",-1)])),_:1,__:[15]}),y(L,{label:"top"},{default:_(()=>t[16]||(t[16]=[D("上",-1)])),_:1,__:[16]}),y(L,{label:"bottom"},{default:_(()=>t[17]||(t[17]=[D("下",-1)])),_:1,__:[17]})]),_:1},8,["modelValue"])])):(h(),p("div",Ot,[t[12]||(t[12]=D(" 画布宽度：",-1)),y(f,{modelValue:M.value.width,"onUpdate:modelValue":t[4]||(t[4]=s=>M.value.width=s)},null,8,["modelValue"]),t[13]||(t[13]=D(" 画布高度：",-1)),y(f,{modelValue:M.value.height,"onUpdate:modelValue":t[5]||(t[5]=s=>M.value.height=s)},null,8,["modelValue"])])),u.value?(h(),p("div",Rt,[t[22]||(t[22]=z("p",null,"已选中一条连线",-1)),y(n,{type:"danger",size:"small",onClick:Ye},{default:_(()=>t[21]||(t[21]=[D("删除连线",-1)])),_:1,__:[21]})])):ee("",!0)])],32)}}}),Kt=["width","height"],It=["d","stroke-width","stroke","onClick"],Jt=["d"],Ut={class:"node-label",style:{position:"absolute",top:"-30px"}},Ht=ye({__name:"FlowPview",props:{bg:{default:""},connections:{default:[]},canvasSize:{default:{width:1920,height:1080}},nodesValue:{default:[]}},setup(oe){const N=c("curve"),Y=oe,k=c(Y.nodesValue),T=c({x:0,y:0}),v=c(),w=c(),E=c(Y.canvasSize),B=()=>{const d=v.value.parentElement,i=d.offsetWidth,u=d.offsetHeight,O=Math.min(i/E.value.width,u/E.value.height);v.value.style.transform=`scale(${O})`;const P=d.parentElement.parentElement.parentElement.offsetHeight;console.log(d.parentElement.parentElement.parentElement),w.value.style.height=P+"px"},K=c(Y.connections),x=d=>N.value==="mindmap"?$(d):m(d),m=d=>{const i=F(d.source),u=F(d.target),O=(i.x+u.x)/2;return`M ${i.x} ${i.y}
          C ${O} ${i.y},
            ${O} ${u.y},
            ${u.x} ${u.y}`},$=d=>{const i=F(d.source),u=F(d.target),O=50,P=i.x+O;return u.x>P&&u.x-O,`M ${i.x} ${i.y}
          L ${P} ${i.y}
          L ${P} ${u.y}
          L ${u.x} ${u.y}`},F=d=>{const i=k.value.find(u=>u.id===d);return i?{x:i.x+i.width/2,y:i.y+i.height/2}:{x:0,y:0}};return Be(()=>{ft(()=>{B()})}),(d,i)=>(h(),p("div",{class:"flow-canvas-container",ref_key:"canvasContainerRef",ref:w},[z("div",{class:"flow-canvas",ref_key:"canvas",ref:v,style:R({backgroundImage:`url(${d.bg})`,transform:`translate(${T.value.x}px, ${T.value.y}px) scale(${d.canvasScale})`,transformOrigin:"0 0",width:`${E.value.width}px`,height:`${E.value.height}px`})},[(h(!0),p(Z,null,Q(d.alignmentGuides,u=>(h(),p("div",{key:u.id,style:R({position:"absolute",left:u.left+"px",top:u.top+"px",width:u.width+"px",height:u.height+"px",background:u.color,zIndex:40}),class:"alignment-guide"},null,4))),128)),(h(),p("svg",{class:"connections-container",width:E.value.width,height:E.value.height},[z("g",null,[(h(!0),p(Z,null,Q(K.value,u=>(h(),p("path",{key:u.id,d:x(u),"stroke-width":(d.selectedConnectionId===u.id,5),stroke:d.selectedConnectionId===u.id?"#000":"#3b82f6",fill:"none",class:"connection-line",onClick:H(O=>d.selectConnection(u.id),["stop"])},null,8,It))),128))]),d.isDrawingConnection?(h(),p("path",{key:0,d:d.getTemporaryConnectionPath(),stroke:"#666","stroke-width":"2","stroke-dasharray":"5,5",fill:"none"},null,8,Jt)):ee("",!0)],8,Kt)),(h(!0),p(Z,null,Q(k.value,u=>(h(),p("div",{key:u.id,class:Ke(["flow-node",{resizing:d.isResizing,"connection-source":d.isDrawingConnection&&d.connectionSourceId===u.id}]),style:R({left:`${u.x}px`,top:`${u.y}px`,width:`${u.width}px`,height:`${u.height}px`,backgroundColor:u.color,borderRadius:u.type==="start"?"50%":"4px"})},[z("div",Ut,de(u.label),1)],6))),128))],4)],512))}}),Ft={key:0,class:"dialog-footer"},Wt=ye({__name:"Cdialog",props:{width:{default:"550px"},height:{default:"400px"},autoClose:{type:Boolean},buttonLoading:{type:Boolean},footer:{type:Boolean,default:!0}},emits:["submit","cancel","close"],setup(oe,{expose:N,emit:Y}){const k=oe,T=c(!1),v=c(""),w=Y,E=()=>{w("close")},B=()=>{T.value=!1},K=m=>{w("submit",m),k.autoClose&&(E(),B()),m==="cancel"&&E()};return N({show:m=>{v.value=m,T.value=!0},hide:B}),(m,$)=>{const F=G("el-button"),d=G("el-dialog");return h(),ze(d,{onClose:E,"destroy-on-close":"",title:v.value,modelValue:T.value,"onUpdate:modelValue":$[2]||($[2]=i=>T.value=i),width:m.width,"append-to-body":""},{footer:_(()=>[m.footer?(h(),p("div",Ft,[y(F,{onClick:$[0]||($[0]=i=>K("cancel"))},{default:_(()=>$[3]||($[3]=[D("取 消",-1)])),_:1,__:[3]}),y(F,{loading:m.buttonLoading,type:"primary",onClick:$[1]||($[1]=i=>K("submit"))},{default:_(()=>$[4]||($[4]=[D("确 定",-1)])),_:1,__:[4]},8,["loading"])])):ee("",!0),Pe(m.$slots,"footers")]),default:_(()=>[T.value?(h(),p("div",{key:0,style:R({height:m.height})},[Pe(m.$slots,"default")],4)):ee("",!0)]),_:3},8,["title","modelValue","width"])}}}),At={style:{"background-color":"#F1F1F1",height:"100vh"}},Gt={style:{width:"100%",height:"100%",overflow:"auto"}},qt=ye({__name:"HomeView",setup(oe){const N=c(),Y=c([{type:"start",label:"",width:50,height:50,color:"green"},{type:"rect",label:"",width:50,height:50,color:"#f0f0f0"}]),k=c([]),T=c([]),v=c();function w(x){k.value=x}const E=x=>{T.value=x},B=x=>{v.value=x},K=x=>{console.log(N.value),N.value.show("预览")};return(x,m)=>(h(),p("div",At,[y(Bt,{onGetcanvasSize:B,onGetConnectionsValue:E,onSaveNodes:K,onGetNodesValue:w,"node-types":Y.value,bg:pe(mt),isConnectionType:""},null,8,["node-types","bg"]),y(Wt,{width:"800",ref_key:"CdialogRef",ref:N},{default:_(()=>[z("div",Gt,[y(Ht,{bg:x.a,connections:T.value,nodesValue:k.value},null,8,["bg","connections","nodesValue"])])]),_:1},512)]))}});export{qt as default};
