import{d as pe,r as i,w as re,o as Oe,a as st,c as p,b as f,F as q,e as N,f as C,g as _e,h as Z,i as j,j as z,t as ve,n as P,k as J,l as A,m as d,u as se,p as it,q as ut,s as ct,v as rt,x as Te,y as vt,z as De}from"./index-NwWoH10E.js";const Ye=""+new URL("logo-DOphsjsJ.png",import.meta.url).href,ht={class:"node-palette"},dt=["onDragstart"],pt={class:"scale-control"},ft={style:{width:"50px","text-align":"center"}},mt={key:0},yt=["onClick"],gt={key:1},xt=["width","height"],wt=["d","stroke-width","stroke","onClick"],bt=["d"],$t=["id","onMousedown","onClick"],Ct={class:"node-label",style:{position:"absolute",top:"-30px"}},_t={key:0,class:"selection-box"},kt=["onMousedown"],Mt=["onMousedown"],St=["onMousedown"],zt=["onMousedown"],Et={class:"config-panel"},Lt={key:1,style:{color:"#999","font-size":"14px"}},Vt={key:2},Xt=50,Dt=pe({__name:"CflowEditorLoader",props:{bg:{default:""},isConnectionType:{type:Boolean,default:!1},nodeTypes:{},connections:{default:[]},nodesValue:{default:[]}},emits:["getcanvasSize","getConnections","getNodesValue","saveNodes","getNodes"],setup(le,{emit:U}){const O=le,M=U,R=i(O.nodeTypes),v=i(O.nodesValue);re(()=>O.nodesValue,e=>{v.value=e});const b=i(O.connections);re(()=>O.connections,e=>{b.value=e});const x=i([]),S=i(-1),X=()=>{S.value<x.value.length-1&&(x.value=x.value.slice(0,S.value+1));const e={nodes:JSON.parse(JSON.stringify(v.value)),connections:JSON.parse(JSON.stringify(b.value))};x.value.push(e),x.value.length>Xt&&x.value.shift(),S.value=x.value.length-1};X();const D=()=>{if(S.value<=0)return;S.value--;const e=x.value[S.value];v.value=JSON.parse(JSON.stringify(e.nodes)),b.value=JSON.parse(JSON.stringify(e.connections)),u.value=[],_.value="",M("getNodesValue",v.value),M("getConnectionsValue",b.value)},V=()=>{if(S.value>=x.value.length-1)return;S.value++;const e=x.value[S.value];v.value=JSON.parse(JSON.stringify(e.nodes)),b.value=JSON.parse(JSON.stringify(e.connections)),M("getNodesValue",v.value),M("getConnectionsValue",b.value)},u=i([]),_=i(""),h=i("curve"),m=i([]),r=i({x:0,y:0}),T=i({}),w=i(1),k=i({x:0,y:0}),E=i({width:1920,height:1080});re(()=>E.value,()=>{M("getcanvasSize",E.value)});const ne=i(!1),fe=i({x:0,y:0}),W=i(!1),G=i(!1),g=i({show:!1,x:0,y:0,width:0,height:0}),B=i(!1),K=i({x:0,y:0}),$=i({width:0,height:0}),me=i(""),Q=i(null),oe=i(null),ie=i(null),Y=i(!1),ee=i(""),H=i({x:0,y:0}),ue=i([]),F=i(8),te=i(!0),I=(e,t)=>{const s=oe.value.getBoundingClientRect();return{x:(e-s.left-k.value.x)/w.value,y:(t-s.top-k.value.y)/w.value}},Re=(e,t)=>{e.dataTransfer.setData("text/plain",JSON.stringify(t)),e.dataTransfer.effectAllowed="copy"},Pe=e=>{if(document.getElementById(e.id),u.value.includes(e.id)){const t=u.value.indexOf(e.id);u.value.splice(t,1)}else u.value.push(e.id)},Be=(e,t)=>{if(console.log(e,t),e.button===2||W.value||G.value||B.value||Y.value)return;!e.ctrlKey&&!e.shiftKey&&!u.value.includes(t.id)?u.value=[t.id]:(e.ctrlKey||e.shiftKey)&&!u.value.includes(t.id)&&u.value.push(t.id),m.value=[...u.value],T.value={},u.value.forEach(n=>{const l=v.value.find(c=>c.id===n);l&&(T.value[n]={x:l.x,y:l.y})});const s=I(e.clientX,e.clientY);r.value={x:s.x,y:s.y},document.addEventListener("mousemove",ye),document.addEventListener("mouseup",ge)},ke=e=>{const t=[],s=v.value.filter(n=>!e.some(l=>l.id===n.id));return e.forEach(n=>{const l={left:n.x,right:n.x+n.width,top:n.y,bottom:n.y+n.height,centerX:n.x+n.width/2,centerY:n.y+n.height/2};Math.abs(l.centerX-E.value.width/2)<=F.value&&(t.push({id:`guide-v-canvas-center-${n.id}`,left:E.value.width/2,top:0,width:2,height:E.value.height,color:"rgba(255, 0, 255, 0.7)"}),te.value&&(n.x=E.value.width/2-n.width/2)),Math.abs(l.centerY-E.value.height/2)<=F.value&&(t.push({id:`guide-h-canvas-center-${n.id}`,left:0,top:E.value.height/2,width:E.value.width,height:2,color:"rgba(255, 0, 255, 0.7)"}),te.value&&(n.y=E.value.height/2-n.height/2)),s.forEach(c=>{const o={left:c.x,right:c.x+c.width,top:c.y,bottom:c.y+c.height,centerX:c.x+c.width/2,centerY:c.y+c.height/2};[{condition:Math.abs(l.top-o.top)<=F.value,guide:{id:`guide-h-top-${n.id}-${c.id}`,left:Math.min(l.left,o.left),top:o.top,width:Math.max(l.right,o.right)-Math.min(l.left,o.left),height:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.y=o.top}},{condition:Math.abs(l.bottom-o.bottom)<=F.value,guide:{id:`guide-h-bottom-${n.id}-${c.id}`,left:Math.min(l.left,o.left),top:o.bottom,width:Math.max(l.right,o.right)-Math.min(l.left,o.left),height:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.y=o.bottom-n.height}},{condition:Math.abs(l.centerY-o.centerY)<=F.value,guide:{id:`guide-h-center-${n.id}-${c.id}`,left:Math.min(l.left,o.left),top:o.centerY,width:Math.max(l.right,o.right)-Math.min(l.left,o.left),height:2,color:"rgba(255, 0, 0, 0.7)"},snap:()=>{n.y=o.centerY-n.height/2}},{condition:Math.abs(l.left-o.left)<=F.value,guide:{id:`guide-v-left-${n.id}-${c.id}`,left:o.left,top:Math.min(l.top,o.top),height:Math.max(l.bottom,o.bottom)-Math.min(l.top,o.top),width:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.x=o.left}},{condition:Math.abs(l.right-o.right)<=F.value,guide:{id:`guide-v-right-${n.id}-${c.id}`,left:o.right,top:Math.min(l.top,o.top),height:Math.max(l.bottom,o.bottom)-Math.min(l.top,o.top),width:2,color:"rgba(0, 200, 0, 0.7)"},snap:()=>{n.x=o.right-n.width}},{condition:Math.abs(l.centerX-o.centerX)<=F.value,guide:{id:`guide-v-center-${n.id}-${c.id}`,left:o.centerX,top:Math.min(l.top,o.top),height:Math.max(l.bottom,o.bottom)-Math.min(l.top,o.top),width:2,color:"rgba(255, 0, 0, 0.7)"},snap:()=>{n.x=o.centerX-n.width/2}},{condition:Math.abs(l.top-o.bottom)<=F.value,guide:{id:`guide-h-top-bottom-${n.id}-${c.id}`,left:Math.min(l.left,o.left),top:o.bottom,width:Math.max(l.right,o.right)-Math.min(l.left,o.left),height:2,color:"rgba(0, 150, 255, 0.7)"},snap:()=>{n.y=o.bottom}},{condition:Math.abs(l.bottom-o.top)<=F.value,guide:{id:`guide-h-bottom-top-${n.id}-${c.id}`,left:Math.min(l.left,o.left),top:o.top,width:Math.max(l.right,o.right)-Math.min(l.left,o.left),height:2,color:"rgba(0, 150, 255, 0.7)"},snap:()=>{n.y=o.top-n.height}}].forEach(a=>{a.condition&&(t.push(a.guide),te.value&&a.snap())})})}),t},ye=e=>{if(m.value.length===0)return;const t=I(e.clientX,e.clientY),s=t.x-r.value.x,n=t.y-r.value.y,l=[];m.value.forEach(o=>{const y=v.value.find(a=>a.id===o);y&&T.value[o]&&(y._tempX=T.value[o].x+s,y._tempY=T.value[o].y+n,l.push(y))}),l.forEach(o=>{o.x=o._tempX,o.y=o._tempY});let c=[];te.value&&(c=ke(l)),ue.value=c},ge=()=>{m.value=[],ue.value=[],document.removeEventListener("mousemove",ye),document.removeEventListener("mouseup",ge),M("getNodesValue",v.value),X()},Ke=e=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");if(t)try{const s=JSON.parse(t),n=I(e.clientX,e.clientY),l={id:`node-${Date.now()}`,...s,label:"未命名图层"+v.value.length,x:n.x-s.width/2,y:n.y-s.height/2,obj:{}};v.value.push(l),he.value=l,u.value=[l.id],M("getNodesValue",v.value),X()}catch(s){console.error("放置节点失败:",s)}},he=i({}),Ie=(e,t)=>{_.value="",!(W.value||G.value||B.value||Y.value)&&(he.value=t,e.ctrlKey||e.shiftKey?u.value.includes(t.id)||u.value.push(t.id):u.value=[t.id])},de=(e,t,s)=>{if(u.value.length!==1||Y.value)return;B.value=!0,me.value=s;const n=I(e.clientX,e.clientY);K.value={x:n.x,y:n.y},$.value={width:t.width,height:t.height},document.addEventListener("mousemove",xe),document.addEventListener("mouseup",we),e.stopPropagation()},xe=e=>{if(!B.value)return;const t=I(e.clientX,e.clientY),s=t.x-K.value.x,n=t.y-K.value.y,l=v.value.find(o=>o.id===u.value[0]);if(!l)return;const c=$.value.width/$.value.height;switch(me.value){case"se":if(e.ctrlKey){const o=Math.max(20,$.value.width+s),y=o/c;l.width=o,l.height=y}else l.width=Math.max(20,$.value.width+s),l.height=Math.max(20,$.value.height+n);break;case"sw":if(e.ctrlKey){const o=Math.max(20,$.value.width-s),y=o/c;l.width=o,l.height=y,l.x=K.value.x-(l.width-$.value.width)}else l.width=Math.max(20,$.value.width-s),l.height=Math.max(20,$.value.height+n),l.x=K.value.x-(l.width-$.value.width);break;case"ne":if(e.ctrlKey){const o=Math.max(20,$.value.width+s),y=o/c;l.width=o,l.height=y,l.y=K.value.y-(l.height-$.value.height)}else l.width=Math.max(20,$.value.width+s),l.height=Math.max(20,$.value.height-n),l.y=K.value.y-(l.height-$.value.height);break;case"nw":if(e.ctrlKey){const o=Math.max(20,$.value.width-s),y=o/c;l.width=o,l.height=y,l.x=K.value.x-(l.width-$.value.width),l.y=K.value.y-(l.height-$.value.height)}else l.width=Math.max(20,$.value.width-s),l.height=Math.max(20,$.value.height-n),l.x=K.value.x-(l.width-$.value.width),l.y=K.value.y-(l.height-$.value.height);break}if(te.value&&l){const o=ke([l]);ue.value=o}},we=()=>{B.value=!1,me.value="",ue.value=[],document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",we),X()},Je=e=>{if(_.value="",W.value||e.target!==ie.value||B.value||Y.value)return;G.value=!0;const t=I(e.clientX,e.clientY);g.value={show:!0,x:t.x,y:t.y,width:0,height:0},document.addEventListener("mousemove",be),document.addEventListener("mouseup",$e)},ae=i({}),be=e=>{if(!G.value)return;const t=I(e.clientX,e.clientY);ae.value={show:!0,x:t.x<g.value.x?t.x:g.value.x,y:t.y<g.value.y?t.y:g.value.y,width:t.x-g.value.x,height:t.y-g.value.y},g.value={show:!0,x:g.value.x,y:g.value.y,width:t.x-g.value.x,height:t.y-g.value.y};const s=Math.min(g.value.x,g.value.x+g.value.width),n=Math.min(g.value.y,g.value.y+g.value.height),l=Math.max(g.value.x,g.value.x+g.value.width),c=Math.max(g.value.y,g.value.y+g.value.height),o=[];v.value.forEach(y=>{const a=y.x,L=y.y,Xe=y.x+y.width,at=y.y+y.height;Xe>s&&a<l&&at>n&&L<c&&o.push(y.id)}),u.value=o},$e=()=>{G.value=!1,g.value.show=!1,ae.value={},document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",$e)},He=e=>{if(e.target===ie.value&&(_.value=""),Y.value){Y.value=!1,ee.value="";return}e.target===ie.value&&e.ctrlKey&&!W.value&&!B.value?Je(e):e.target===ie.value&&!W.value&&!G.value&&!e.ctrlKey&&!B.value&&(u.value=[])},Me=()=>{if(u.value.length===0)return;const e=v.value.find(t=>t.id===u.value[0]);e&&(Q.value=JSON.parse(JSON.stringify(e)),Q.value.label=Q.value.label+"-copy")},Se=()=>{if(!Q.value)return;const e={...JSON.parse(JSON.stringify(Q.value)),id:`node-${Date.now()}`,x:Q.value.x+20,y:Q.value.y+20};v.value.push(e),u.value=[e.id],X()},Fe=()=>{u.value.length!==0&&(v.value=v.value.filter(e=>!u.value.includes(e.id)),M("getNodesValue",v.value),b.value=b.value.filter(e=>!u.value.includes(e.source)&&!u.value.includes(e.target)),u.value=[],M("getConnectionsValue",b.value),X())},ze=()=>{_.value&&(b.value=b.value.filter(e=>e.id!==_.value),_.value="",M("getConnectionsValue",b.value),X())},Ue=e=>{e.preventDefault();const t=oe.value.getBoundingClientRect(),s=e.clientX-t.left,n=e.clientY-t.top,l=(s-k.value.x)/w.value,c=(n-k.value.y)/w.value,y=-e.deltaY>0?1.1:.9,a=Math.max(.1,Math.min(5,w.value*y));k.value.x=s-l*a,k.value.y=n-c*a,w.value=a},We=e=>{W.value&&e.button===0&&!B.value&&!Y.value&&(ne.value=!0,fe.value={x:e.clientX-k.value.x,y:e.clientY-k.value.y},e.preventDefault())},Ae=e=>{if(ne.value)k.value.x=e.clientX-fe.value.x,k.value.y=e.clientY-fe.value.y;else if(Y.value){const t=I(e.clientX,e.clientY);H.value=t}},Ee=()=>{ne.value=!1},Le=e=>{if(e.ctrlKey||e.metaKey){if(e.key.toLowerCase()==="z"){D(),e.preventDefault();return}else if(e.key.toLowerCase()==="y"){V(),e.preventDefault();return}}if(e.key==="Delete"&&_.value){ze(),e.preventDefault();return}if(e.code==="Space"&&(W.value=!0,e.preventDefault()),e.key==="Alt"&&(te.value=!1),e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"c":Me(),e.preventDefault();break;case"v":Se(),e.preventDefault();break;case"d":Me(),Se(),e.preventDefault();break}if(e.key==="Backspace"){const t=document.activeElement;t.tagName==="INPUT"||t.tagName==="TEXTAREA"||(Fe(),e.preventDefault())}},Ve=e=>{e.code==="Space"&&(W.value=!1,ne.value=!1),e.key==="Alt"&&(te.value=!0)},Ge=()=>{const e=oe.value.getBoundingClientRect(),t=e.width/2,s=e.height/2,n=(t-k.value.x)/w.value,l=(s-k.value.y)/w.value,c=Math.min(5,w.value+.1);k.value.x=t-n*c,k.value.y=s-l*c,w.value=c},je=()=>{const e=oe.value.getBoundingClientRect(),t=e.width/2,s=e.height/2,n=(t-k.value.x)/w.value,l=(s-k.value.y)/w.value,c=Math.max(.1,w.value-.1);k.value.x=t-n*c,k.value.y=s-l*c,w.value=c},qe=()=>{w.value=1,k.value={x:0,y:0}},Ne=e=>{if(!O.isConnectionType)return;G.value=!1,B.value=!1,ne.value=!1,_.value="",Y.value=!0,ee.value=e.id,oe.value.getBoundingClientRect();const t=I(event.clientX,event.clientY);H.value=t,document.addEventListener("mousemove",Ce)},Ce=e=>{if(!Y.value)return;const t=I(e.clientX,e.clientY);H.value=t},Ze=e=>{if(!Y.value)return;document.removeEventListener("mousemove",Ce);const t=I(e.clientX,e.clientY),s=v.value.find(n=>t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height&&n.id!==ee.value);s&&(b.value.push({id:`conn-${Date.now()}`,source:ee.value,target:s.id}),M("getConnectionsValue",b.value),X()),Y.value=!1,ee.value=""},ce=e=>{const t=v.value.find(s=>s.id===e);return t?{x:t.x+t.width/2,y:t.y+t.height/2}:{x:0,y:0}},Qe=e=>h.value==="mindmap"?tt(e):et(e),et=e=>{const t=ce(e.source),s=ce(e.target),n=(t.x+s.x)/2;return`M ${t.x} ${t.y}
          C ${n} ${t.y},
            ${n} ${s.y},
            ${s.x} ${s.y}`},tt=e=>{const t=ce(e.source),s=ce(e.target),n=50,l=t.x+n;return s.x>l&&s.x-n,`M ${t.x} ${t.y}
          L ${l} ${t.y}
          L ${l} ${s.y}
          L ${s.x} ${s.y}`},lt=()=>{const e=ce(ee.value);if(h.value==="mindmap"){const s=e.x+50;return`M ${e.x} ${e.y}
            L ${s} ${e.y}
            L ${s} ${H.value.y}
            L ${H.value.x} ${H.value.y}`}else{const t=(e.x+H.value.x)/2;return`M ${e.x} ${e.y}
            C ${t} ${e.y},
              ${t} ${H.value.y},
              ${H.value.x} ${H.value.y}`}},nt=e=>{u.value=[],_.value=e};re(v,()=>{},{deep:!0}),re(h,()=>{}),Oe(()=>{document.querySelector(".flow-editor").focus()});const ot=()=>{M("saveNodes",v.value)};return st(()=>{document.removeEventListener("mousemove",ye),document.removeEventListener("mouseup",ge),document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",$e),document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",we),document.removeEventListener("keydown",Le),document.removeEventListener("keyup",Ve),document.removeEventListener("mousemove",Ce)}),(e,t)=>{const s=j("el-icon"),n=j("el-button"),l=j("el-option"),c=j("el-select"),o=j("el-popover"),y=j("el-input");return d(),p("div",{class:"flow-editor",onWheel:Ue,onKeydown:Le,onKeyup:Ve,onMousedown:We,onMousemove:Ae,onMouseup:Ee,onMouseleave:Ee,tabindex:"0"},[f("div",ht,[(d(!0),p(q,null,N(R.value,a=>(d(),p("div",{style:P({width:a.width+"px",height:a.height+"px",backgroundColor:a.color,borderRadius:a.type==="start"?"50%":"4px"}),key:a.type,class:"palette-node",draggable:"true",onDragstart:L=>Re(L,a)},ve(a.label),45,dt))),128))]),f("div",{class:"flow-canvas-container",ref_key:"canvasContainer",ref:oe,style:P({cursor:ne.value?"grabbing":W.value?"grab":G.value||Y.value?"crosshair":"default"})},[f("div",pt,[C(s,{onClick:Ge},{default:z(()=>[C(se(it))]),_:1}),f("div",ft,ve(Math.round(w.value*100))+"%",1),C(s,{onClick:je},{default:z(()=>[C(se(ut))]),_:1}),C(n,{size:"small",onClick:qe},{default:z(()=>t[6]||(t[6]=[A("重置",-1)])),_:1,__:[6]}),C(s,{onClick:D,disabled:S.value<0,style:P([{"margin-left":"10px",cursor:"pointer"},{opacity:S.value<0?.5:1}])},{default:z(()=>[C(se(ct))]),_:1},8,["disabled","style"]),C(s,{onClick:V,disabled:S.value>=x.value.length-1,style:P([{cursor:"pointer"},{opacity:S.value>=x.value.length-1?.5:1}])},{default:z(()=>[C(se(rt))]),_:1},8,["disabled","style"]),e.isConnectionType?(d(),_e(c,{key:0,size:"small",modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),style:{width:"120px","margin-left":"10px"},placeholder:"连线方式"},{default:z(()=>[C(l,{label:"曲线",value:"curve"})]),_:1},8,["modelValue"])):Z("",!0),C(o,{placement:"bottom",width:400,trigger:"hover"},{reference:z(()=>[C(n,{size:"small",style:{"margin-right":"16px"}},{default:z(()=>t[7]||(t[7]=[A("图层",-1)])),_:1,__:[7]})]),default:z(()=>[v.value.length>0?(d(),p("div",mt,[(d(!0),p(q,null,N(v.value,(a,L)=>(d(),p("div",{style:P({color:u.value.includes(a.id)?"red":""}),class:"liners",onClick:Xe=>Pe(a),key:a.id},ve(a.label),13,yt))),128))])):(d(),p("div",gt," 请选择图层 "))]),_:1}),C(o,{placement:"bottom",width:400,trigger:"hover"},{reference:z(()=>[C(n,{size:"small",style:{"margin-right":"16px"}},{default:z(()=>t[8]||(t[8]=[A("使用说明",-1)])),_:1,__:[8]})]),default:z(()=>[t[9]||(t[9]=f("div",null,[f("p",null,"1.按住ctrl+鼠标左键拖动可以选择多个图层"),f("p",null,"2.按住shift+鼠标左键拖动可以添加到当前选择的图层"),f("p",null,"3.单击图层可以编辑图层名称"),f("p",null,"4.按住ctrl+c可以复制节点"),f("p",null,"5.按住ctrl+v可以粘贴节点"),f("p",null,"6.按住ctrl+z可以撤销操作"),f("p",null,"7.按住ctrl+y可以重写操作"),f("p",null,"8.按住空格可以移动画布"),f("p",null,"9.按住ctrl+鼠标滚轮可以放大缩小画布"),f("p",null,"10.按住ctrl+鼠标滚轮可以放大缩小画布"),f("p",null,"11.按住鼠标右键可以连线节点"),f("p",null,"12.选中节点按删除键可以删除节点")],-1))]),_:1,__:[9]})]),f("div",{class:"flow-canvas",ref_key:"canvas",ref:ie,style:P({backgroundImage:`url(${e.bg})`,transform:`translate(${k.value.x}px, ${k.value.y}px) scale(${w.value})`,transformOrigin:"0 0",width:`${E.value.width}px`,height:`${E.value.height}px`}),onDragover:t[1]||(t[1]=J(()=>{},["prevent"])),onDrop:Ke,onMousedown:He,onMouseup:Ze,onContextmenu:t[2]||(t[2]=J(()=>{},["prevent"]))},[(d(!0),p(q,null,N(ue.value,a=>(d(),p("div",{key:a.id,style:P({position:"absolute",left:a.left+"px",top:a.top+"px",width:a.width+"px",height:a.height+"px",background:a.color,zIndex:40}),class:"alignment-guide"},null,4))),128)),(d(),p("svg",{class:"connections-container",width:E.value.width,height:E.value.height},[f("g",null,[(d(!0),p(q,null,N(b.value,a=>(d(),p("path",{key:a.id,d:Qe(a),"stroke-width":(_.value===a.id,5),stroke:_.value===a.id?"#000":"#3b82f6",fill:"none",class:"connection-line",onClick:J(L=>nt(a.id),["stop"]),style:{cursor:"pointer"}},null,8,wt))),128))]),Y.value?(d(),p("path",{key:0,d:lt(),stroke:"#666","stroke-width":"2","stroke-dasharray":"5,5",fill:"none"},null,8,bt)):Z("",!0)],8,xt)),(d(!0),p(q,null,N(v.value,a=>(d(),p("div",{key:a.id,class:Te(["flow-node",{selected:u.value.includes(a.id),dragging:m.value.includes(a.id),resizing:B.value,"connection-source":Y.value&&ee.value===a.id}]),id:a.id,style:P({left:`${a.x}px`,top:`${a.y}px`,width:`${a.width}px`,height:`${a.height}px`,backgroundColor:a.color,borderRadius:a.type==="start"?"50%":"4px"}),onMousedown:[J(L=>Be(L,a),["stop"]),J(L=>Ne(a),["right","prevent"])],onClick:J(L=>Ie(L,a),["stop"])},[f("div",Ct,ve(a.label),1),u.value.includes(a.id)?(d(),p("div",_t,[f("div",{class:"resize-handle resize-handle-se",onMousedown:J(L=>de(L,a,"se"),["stop"])},null,40,kt),f("div",{class:"resize-handle resize-handle-sw",onMousedown:J(L=>de(L,a,"sw"),["stop"])},null,40,Mt),f("div",{class:"resize-handle resize-handle-ne",onMousedown:J(L=>de(L,a,"ne"),["stop"])},null,40,St),f("div",{class:"resize-handle resize-handle-nw",onMousedown:J(L=>de(L,a,"nw"),["stop"])},null,40,zt)])):Z("",!0)],46,$t))),128)),g.value.show?(d(),p("div",{key:0,class:"selection-box-area",style:P({"--box-x":`${ae.value.x}px`,"--box-y":`${ae.value.y}px`,"--box-width":`${ae.value.width}px`,"--box-height":`${ae.value.height}px`})},null,4)):Z("",!0)],36)],4),f("div",Et,[C(n,{onClick:ot},{default:z(()=>t[10]||(t[10]=[A("预览",-1)])),_:1,__:[10]}),u.value.length===1?(d(),_e(y,{key:0,modelValue:he.value.label,"onUpdate:modelValue":t[3]||(t[3]=a=>he.value.label=a),placeholder:"节点名称"},null,8,["modelValue"])):(d(),p("div",Lt,[t[11]||(t[11]=A(" 画布宽度：",-1)),C(y,{modelValue:E.value.width,"onUpdate:modelValue":t[4]||(t[4]=a=>E.value.width=a)},null,8,["modelValue"]),t[12]||(t[12]=A(" 画布高度：",-1)),C(y,{modelValue:E.value.height,"onUpdate:modelValue":t[5]||(t[5]=a=>E.value.height=a)},null,8,["modelValue"])])),_.value?(d(),p("div",Vt,[t[14]||(t[14]=f("p",null,"已选中一条连线",-1)),C(n,{type:"danger",size:"small",onClick:ze},{default:z(()=>t[13]||(t[13]=[A("删除连线",-1)])),_:1,__:[13]})])):Z("",!0)])],32)}}}),Yt=["width","height"],Ot=["d","stroke-width","stroke","onClick"],Tt=["d"],Rt={class:"node-label",style:{position:"absolute",top:"-30px"}},Pt=pe({__name:"FlowPview",props:{bg:{default:""},connections:{default:[]},canvasSize:{default:{width:1920,height:1080}},nodesValue:{default:[]}},setup(le){const U=i("curve"),O=le,M=i(O.nodesValue),R=i({x:0,y:0}),v=i(),b=i(),x=i(O.canvasSize),S=()=>{const h=v.value.parentElement,m=h.offsetWidth,r=h.offsetHeight,T=Math.min(m/x.value.width,r/x.value.height);v.value.style.transform=`scale(${T})`;const w=h.parentElement.parentElement.parentElement.offsetHeight;console.log(h.parentElement.parentElement.parentElement),b.value.style.height=w+"px"},X=i(O.connections),D=h=>U.value==="mindmap"?u(h):V(h),V=h=>{const m=_(h.source),r=_(h.target),T=(m.x+r.x)/2;return`M ${m.x} ${m.y}
          C ${T} ${m.y},
            ${T} ${r.y},
            ${r.x} ${r.y}`},u=h=>{const m=_(h.source),r=_(h.target),T=50,w=m.x+T;return r.x>w&&r.x-T,`M ${m.x} ${m.y}
          L ${w} ${m.y}
          L ${w} ${r.y}
          L ${r.x} ${r.y}`},_=h=>{const m=M.value.find(r=>r.id===h);return m?{x:m.x+m.width/2,y:m.y+m.height/2}:{x:0,y:0}};return Oe(()=>{vt(()=>{S()})}),(h,m)=>(d(),p("div",{class:"flow-canvas-container",ref_key:"canvasContainerRef",ref:b},[f("div",{class:"flow-canvas",ref_key:"canvas",ref:v,style:P({backgroundImage:`url(${h.bg})`,transform:`translate(${R.value.x}px, ${R.value.y}px) scale(${h.canvasScale})`,transformOrigin:"0 0",width:`${x.value.width}px`,height:`${x.value.height}px`})},[(d(!0),p(q,null,N(h.alignmentGuides,r=>(d(),p("div",{key:r.id,style:P({position:"absolute",left:r.left+"px",top:r.top+"px",width:r.width+"px",height:r.height+"px",background:r.color,zIndex:40}),class:"alignment-guide"},null,4))),128)),(d(),p("svg",{class:"connections-container",width:x.value.width,height:x.value.height},[f("g",null,[(d(!0),p(q,null,N(X.value,r=>(d(),p("path",{key:r.id,d:D(r),"stroke-width":(h.selectedConnectionId===r.id,5),stroke:h.selectedConnectionId===r.id?"#000":"#3b82f6",fill:"none",class:"connection-line",onClick:J(T=>h.selectConnection(r.id),["stop"])},null,8,Ot))),128))]),h.isDrawingConnection?(d(),p("path",{key:0,d:h.getTemporaryConnectionPath(),stroke:"#666","stroke-width":"2","stroke-dasharray":"5,5",fill:"none"},null,8,Tt)):Z("",!0)],8,Yt)),(d(!0),p(q,null,N(M.value,r=>(d(),p("div",{key:r.id,class:Te(["flow-node",{resizing:h.isResizing,"connection-source":h.isDrawingConnection&&h.connectionSourceId===r.id}]),style:P({left:`${r.x}px`,top:`${r.y}px`,width:`${r.width}px`,height:`${r.height}px`,backgroundColor:r.color,borderRadius:r.type==="start"?"50%":"4px"})},[f("div",Rt,ve(r.label),1)],6))),128))],4)],512))}}),Bt={key:0,class:"dialog-footer"},Kt=pe({__name:"Cdialog",props:{width:{default:"550px"},height:{default:"400px"},autoClose:{type:Boolean},buttonLoading:{type:Boolean},footer:{type:Boolean,default:!0}},emits:["submit","cancel","close"],setup(le,{expose:U,emit:O}){const M=le,R=i(!1),v=i(""),b=O,x=()=>{b("close")},S=()=>{R.value=!1},X=V=>{b("submit",V),M.autoClose&&(x(),S()),V==="cancel"&&x()};return U({show:V=>{v.value=V,R.value=!0},hide:S}),(V,u)=>{const _=j("el-button"),h=j("el-dialog");return d(),_e(h,{onClose:x,"destroy-on-close":"",title:v.value,modelValue:R.value,"onUpdate:modelValue":u[2]||(u[2]=m=>R.value=m),width:V.width,"append-to-body":""},{footer:z(()=>[V.footer?(d(),p("div",Bt,[C(_,{onClick:u[0]||(u[0]=m=>X("cancel"))},{default:z(()=>u[3]||(u[3]=[A("取 消",-1)])),_:1,__:[3]}),C(_,{loading:V.buttonLoading,type:"primary",onClick:u[1]||(u[1]=m=>X("submit"))},{default:z(()=>u[4]||(u[4]=[A("确 定",-1)])),_:1,__:[4]},8,["loading"])])):Z("",!0),De(V.$slots,"footers")]),default:z(()=>[R.value?(d(),p("div",{key:0,style:P({height:V.height})},[De(V.$slots,"default")],4)):Z("",!0)]),_:3},8,["title","modelValue","width"])}}}),It={style:{"background-color":"#F1F1F1",height:"100vh"}},Jt={style:{width:"100%",height:"100%",overflow:"auto"}},Ft=pe({__name:"HomeView",setup(le){const U=i(),O=i([{type:"start",label:"",width:50,height:50,color:"green"},{type:"rect",label:"",width:50,height:50,color:"#f0f0f0"}]),M=i([]),R=i([]),v=i();function b(D){M.value=D,console.log(D)}const x=D=>{R.value=D,console.log(D)},S=D=>{v.value=D},X=D=>{console.log(U.value),U.value.show("预览")};return(D,V)=>(d(),p("div",It,[C(Dt,{onGetcanvasSize:S,onGetConnectionsValue:x,onSaveNodes:X,onGetNodesValue:b,"node-types":O.value,bg:se(Ye),isConnectionType:""},null,8,["node-types","bg"]),C(Kt,{width:"800",ref_key:"CdialogRef",ref:U},{default:z(()=>[f("div",Jt,[C(Pt,{bg:se(Ye),connections:R.value,nodesValue:M.value},null,8,["bg","connections","nodesValue"])])]),_:1},512)]))}});export{Ft as default};
